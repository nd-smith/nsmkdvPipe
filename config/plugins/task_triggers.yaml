# Task Trigger Plugin Configuration
#
# This file configures automatic actions when specific tasks are processed.
# Each trigger watches for a task_id (template ID) and executes actions
# when that task is assigned or completed.
#
# Available actions:
#   - publish_to_topic: Send message to a Kafka topic
#   - webhook: Call an HTTP endpoint
#   - log: Write to structured log
#
# The payload sent to topics/webhooks includes:
#   - trigger_name, event_id, event_type, project_id
#   - task_id, assignment_id, task_name, task_status
#   - task: full task data (if include_task_data: true)
#   - project: project data (if include_project_data: true)

task_triggers:
  # Example: Photo Documentation Task Trigger
  - name: "photo_documentation_trigger"
    description: "Triggers when photo documentation tasks are assigned/completed"
    enabled: true
    include_task_data: true
    include_project_data: false
    triggers:
      # Replace 456 with your actual task template ID
      - task_id: 456
        name: "Photo Documentation"
        on_assigned:
          # When task is assigned, publish to this topic
          publish_to_topic: "claimx-task-photo-assigned"
          log:
            level: info
            message: "Photo documentation task assigned"
        on_completed:
          # When task is completed, publish and call webhook
          publish_to_topic: "claimx-task-photo-completed"
          webhook:
            url: "${PHOTO_TASK_WEBHOOK_URL}"
            method: POST
            headers:
              X-API-Key: "${WEBHOOK_API_KEY}"

  # Example: Damage Assessment Trigger
  - name: "damage_assessment_trigger"
    description: "Triggers when damage assessment tasks complete"
    enabled: true
    include_task_data: true
    include_project_data: true  # Include project details
    triggers:
      - task_id: 789
        name: "Damage Assessment"
        on_completed:
          publish_to_topic: "claimx-damage-assessment-complete"
          webhook: "https://api.example.com/damage-assessment/notify"

  # Example: SLA-Critical Task Trigger
  - name: "sla_critical_trigger"
    description: "Triggers for SLA-critical task types"
    enabled: false  # Disabled - enable when ready
    include_task_data: true
    triggers:
      - task_id: 100
        name: "Initial Contact"
        on_assigned:
          publish_to_topic: "sla-tracking-initial-contact"
      - task_id: 101
        name: "Inspection Scheduling"
        on_assigned:
          publish_to_topic: "sla-tracking-inspection"
      - task_id: 102
        name: "Report Submission"
        on_completed:
          publish_to_topic: "sla-tracking-report-complete"
